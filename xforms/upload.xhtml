<?xml-stylesheet href="/xsltforms/build/xsltforms.xsl" type="text/xsl"?><?xsltforms-options debug="no"?><?css-conversion no?><?xml-model href="http://www.oxygenxml.com/1999/xhtml/xhtml-xforms.nvdl" schematypens="http://purl.oclc.org/dsdl/nvdl/ns/structure/1.0"?>
<!--<?xsltforms-options domengine="name=Fleur;url=/static/xphoneforms/build/js/fleur.js;uri=http://www.agencexml.com/Fleur;version=1.0"?>-->
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:xf="http://www.w3.org/2002/xforms"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <head>
        <meta content="IE=edge" http-equiv="X-UA-Compatible" />
        <title>Test form-data submission</title>
        <xf:model>
            <xf:instance id="file-upload">
                <data xmlns="">
                    <upload filename="">
                        <fileToConvert></fileToConvert>
                    </upload>
                </data>
            </xf:instance>
            <xf:submission id="upload-file" method="form-data-post"
                mode="asynchronous" ref="instance('file-upload')/upload"
                mediatype="multipart/form-data" omit-xml-declaration="true"
                replace="none"
                resource="http://www.tei-c.org/ege-webservice//Conversions/TEI%3Atext%3Axml/xml%3Aapplication%3Axml/conversion?properties=%3Cconversions%3E%3Cconversion%20index=%220%22%3E%3Cproperty%20id=%22oxgarage.getImages%22%3Efalse%3C/property%3E%3Cproperty%20id=%22oxgarage.getOnlineImages%22%3Efalse%3C/property%3E%3Cproperty%20id=%22oxgarage.lang%22%3Een%3C/property%3E%3Cproperty%20id=%22oxgarage.textOnly%22%3Etrue%3C/property%3E%3Cproperty%20id=%22pl.psnc.dl.ege.tei.profileNames%22%3Edefault%3C/property%3E%3C/conversion%3E%3C/conversions%3E">
                <xf:action ev:event="xforms-submit-done">
                    <xf:insert context="instance('result')/result"
                        origin="event('response-body')"/>dd
                </xf:action>
            </xf:submission>
            <xf:instance id="serialize">
                <xsl:stylesheet exclude-result-prefixes="xs" version="1.0"
                    xmlns:xs="http://www.w3.org/2001/XMLSchema"
                    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                    xmlns="http://www.tei-c.org/ns/1.0">

                    <xsl:output method="xml" omit-xml-declaration="yes"/>

                    <xsl:template match="@* | node()">
                        <xsl:copy>
                            <xsl:apply-templates select="@* | node()"/>
                        </xsl:copy>
                    </xsl:template>

                </xsl:stylesheet>
            </xf:instance>            
            <xf:instance id="content">
                <TEI xmlns="http://www.tei-c.org/ns/1.0" xml:lang="en">
                    <teiHeader>
                        <fileDesc>
                            <titleStmt>
                                <title>My TEI Extension</title>
                                <author>generated by Muscovy</author>
                            </titleStmt>
                            <publicationStmt>
                                <p>for use by whoever wants it</p>
                            </publicationStmt>
                            <sourceDesc>
                                <p>created using Muscovy</p>
                            </sourceDesc>
                        </fileDesc>
                    </teiHeader>
                    <text>
                        <front>
                            <divGen type="toc"/>
                        </front>
                        <body>
                            <p>My TEI Customization&#xD; starts with modules tei, core, textstructure and header</p>
                            <schemaSpec ident="myTEI" docLang="en" prefix="tei_"
                                xml:lang="en">
                                <moduleRef key="core" except=""/>
                                <moduleRef key="tei" except=""/>
                                <moduleRef key="header" except=""/>
                                <moduleRef key="textstructure" except=""/>
                            </schemaSpec>
                        </body>
                    </text>
                </TEI>
            </xf:instance>
            <xf:instance id="result">
                <data xmlns="">
                    <result></result>
                </data>
            </xf:instance>
        </xf:model>
    </head>
    <body>
        <xf:group ref="instance('file-upload')/upload">

            <h1>Test <code>form-data</code> submission</h1>

            <xf:group>
                <!--<xf:upload ref="fileToConvert" mediatype="application/xml"
                    incremental="true">
                    <xf:label>Select</xf:label>
                    <xf:filename ref="instance('file-upload')/upload/@filename"
                    />
                </xf:upload>-->
                <xf:submit>
                    <xf:label>Submit</xf:label>
                    <xf:setvalue ev:event="DOMActivate" ref="instance('file-upload')/upload/fileToConvert" value="transform(instance('content'), serialize(instance('serialize')), true())"/>
                    <xf:send submission="upload-file"/>
                </xf:submit>
            </xf:group>

            <xf:group>
                <xf:output value="serialize(instance('result'))"/>
            </xf:group>

        </xf:group>
    </body>
</html>
